<html>
    <head>
        <title>Client</title> 
        <meta name="viewport" content="width=device-width, initial-scale=1">              
        <link rel="stylesheet" 
        href="https://www.w3schools.com/w3css/4/w3.css">


    </head>
    <body>

        <header class="w3-row">
            <section class="w3-col w3-mobile w3-container w3-indigo">
                <h5>Teszt oldal</h5>
            </section>
        </header>

        <article class="w3-row-padding">
            <section class="w3-col w3-mobile s4 w3-container w3-display-middle" style="margin: 10px;">
                <section class="w3-card-4">
                    <img class="w3-center" id= "frame" src="" alt="A kamera nem elérhető" style="width: 100%;">
                    <section class="w3-card4 w3-container w3-left">
                    </section>
                    <aside class="w3-container w3-center">
                        <p>ESP32-Cam OV2640
                            <span class="w3-right" id="msglen" style="font-size: 8pt;">Msg len: 0</span>
                        </p>
                    </aside>
                </section> 
            </section>
        </article>
        <footer class="w3-row">
            <section class="w3-col w3-mobile w3-container w3-display-bottommiddle w3-indigo">
                <h5 class="w3-right" id="date"></h5>
            </section>
        </footer>

        <script>
            const img = document.getElementById("frame");
            const dateTxt = document.getElementById("date");
            const msglen = document.getElementById("msglen");

            const addZero = (act) => {
                return act < 10 ? '0' + act  : act;
            }

            const updateTime = () => {
                let d = new Date();
                dateTxt.innerHTML = `${d.getFullYear()}.${addZero(d.getMonth() + 1)}.${addZero(d.getDate())} ${addZero(d.getHours())}:${addZero(d.getMinutes())}:${addZero(d.getSeconds())}`;
            }

            const WS_URL = 'ws:///192.168.1.75:8888';
            const url = "data:image/png;base64, ";

            setInterval(updateTime, 1000);

            const ws = new WebSocket(WS_URL);
            ws.onopen = () => console.log(`Connected to ${WS_URL}`);
                ws.onmessage = message => {            
                img.src =url+ message.data; 
                let msgl = 4*Math.ceil(message.data.length / 3.0);
                msglen.innerHTML = "Msg len: " + msgl + "B";
                }
        </script>
    </body>
</html>

